[
    #(load "kv" "io" "alu")

    (io/put "=== DATA INTEGRITY VERIFICATION TEST ===\n")
    (io/put "This test stores values and uses them in operations to verify correctness\n")
    (kv/open-memory store)

    (io/put "\n--- Integer Integrity: Store 100, retrieve, add 50 ---\n")
    (kv/set store:num 100)
    (def retrieved_num (kv/get store:num))
    (def result (alu/add retrieved_num 50))
    (io/put "Result: %d (expected 150)\n" result)

    (io/put "\n--- Real Integrity: Store 2.5, retrieve, multiply by 4.0 ---\n")
    (kv/set store:real 2.5)
    (def retrieved_real (kv/get store:real))
    (def result_real (alu/mul_r retrieved_real 4.0))
    (io/put "Result: %f (expected 10.0)\n" result_real)

    (io/put "\n--- String Integrity: Store and compare length/content ---\n")
    (kv/set store:str "test123")
    (def retrieved_str (kv/get store:str))
    (io/put "Retrieved: %s (expected test123)\n" retrieved_str)

    (io/put "\n--- Multi-Store Test: Store 3 numbers, retrieve all, verify ---\n")
    (kv/set store:a 10)
    (kv/set store:b 20)
    (kv/set store:c 30)
    (def a (kv/get store:a))
    (def b (kv/get store:b))
    (def c (kv/get store:c))
    (def sum_ab (alu/add a b))
    (def sum_all (alu/add sum_ab c))
    (io/put "Sum of 10+20+30 = %d (expected 60)\n" sum_all)

    (io/put "\n--- Overwrite Test: Store 100, overwrite with 200, verify ---\n")
    (kv/set store:overwrite 100)
    (kv/set store:overwrite 200)
    (def ov (kv/get store:overwrite))
    (io/put "After overwrite: %d (expected 200)\n" ov)

    (io/put "\n--- Cross-Type Test: Store int, real, string independently ---\n")
    (kv/set store:cross_int 42)
    (kv/set store:cross_real 3.14)
    (kv/set store:cross_str "hello")
    (def ci (kv/get store:cross_int))
    (def cr (kv/get store:cross_real))
    (def cs (kv/get store:cross_str))
    (io/put "Int: %d, Real: %f, String: %s\n" ci cr cs)

    (io/put "\n=== INTEGRITY VERIFICATION COMPLETE ===\n")
    (io/put "If all values match expected, serialization is working correctly!\n")
]

