[
    #(load "forge" "io")

    (io/put "=== Forge Drop Match Test ===\n")

    (io/put "\n--- Drop matching integers ---\n")
    (def x0 '(1 2 3 2 4 2))
    (def x1 (forge/drop_match x0 2))
    (assert (eq (forge/count x1) 3) "After dropping 2s, should have 3 elements")
    (def x1_list (cast :list-p x1))
    (assert (eq (at 0 x1_list) 1) "First element should be 1")
    (assert (eq (at 1 x1_list) 3) "Second element should be 3")
    (assert (eq (at 2 x1_list) 4) "Third element should be 4")
    (io/put "Dropped all 2s from (1 2 3 2 4 2)\n")

    (io/put "\n--- Drop matching symbols ---\n")
    (def y0 '(a b c b d b))
    (def y1 (forge/drop_match y0 b))
    (assert (eq (forge/count y1) 3) "After dropping bs, should have 3 elements")
    (def y1_list (cast :list-p y1))
    (assert (eq (at 0 y1_list) 'a) "First element should be a")
    (assert (eq (at 1 y1_list) 'c) "Second element should be c")
    (assert (eq (at 2 y1_list) 'd) "Third element should be d")
    (io/put "Dropped all b from (a b c b d b)\n")

    (io/put "\n--- Drop non-existent ---\n")
    (def z0 '(1 2 3))
    (def z1 (forge/drop_match z0 99))
    (assert (eq (forge/count z1) 3) "Drop non-existent should not change size")
    (def z1_list (cast :list-p z1))
    (assert (eq (at 0 z1_list) 1) "First element should be 1")
    (assert (eq (at 1 z1_list) 2) "Second element should be 2")
    (assert (eq (at 2 z1_list) 3) "Third element should be 3")
    (io/put "Dropped non-existent value - no change\n")

    (io/put "\n--- Drop all elements ---\n")
    (def w0 '(1 1 1 1))
    (def w1 (forge/drop_match w0 1))
    (assert (eq (forge/count w1) 0) "Drop all should give empty list")
    (io/put "Dropped all elements - empty list\n")

    (io/put "\n=== All drop_match tests complete ===\n")
]
