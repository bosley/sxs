[
    #(load "forge" "io")

    (io/put "=== Forge Rotation Test ===\n")

    (io/put "\n--- Rotate Right ---\n")
    (def x0 '(1 2 3 4 5))
    (def x1 (forge/rotr x0 1))
    (assert (eq (forge/count x1) 5) "Rotate right should preserve size")
    (def x1_list (cast :list-p x1))
    (assert (eq (at 0 x1_list) 5) "First element should be 5")
    (assert (eq (at 1 x1_list) 1) "Second element should be 1")
    (assert (eq (at 4 x1_list) 4) "Last element should be 4")
    (io/put "Rotate right (1 2 3 4 5) by 1\n")
    (def x2 (forge/rotr x0 2))
    (assert (eq (forge/count x2) 5) "Rotate right should preserve size")
    (def x2_list (cast :list-p x2))
    (assert (eq (at 0 x2_list) 4) "First element should be 4")
    (assert (eq (at 1 x2_list) 5) "Second element should be 5")
    (assert (eq (at 2 x2_list) 1) "Third element should be 1")
    (io/put "Rotate right (1 2 3 4 5) by 2\n")

    (io/put "\n--- Rotate Left ---\n")
    (def y0 '(1 2 3 4 5))
    (def y1 (forge/rotl y0 1))
    (assert (eq (forge/count y1) 5) "Rotate left should preserve size")
    (def y1_list (cast :list-p y1))
    (assert (eq (at 0 y1_list) 2) "First element should be 2")
    (assert (eq (at 1 y1_list) 3) "Second element should be 3")
    (assert (eq (at 4 y1_list) 1) "Last element should be 1")
    (io/put "Rotate left (1 2 3 4 5) by 1\n")
    (def y2 (forge/rotl y0 2))
    (assert (eq (forge/count y2) 5) "Rotate left should preserve size")
    (def y2_list (cast :list-p y2))
    (assert (eq (at 0 y2_list) 3) "First element should be 3")
    (assert (eq (at 1 y2_list) 4) "Second element should be 4")
    (assert (eq (at 4 y2_list) 2) "Last element should be 2")
    (io/put "Rotate left (1 2 3 4 5) by 2\n")

    (io/put "\n--- Rotate full cycle ---\n")
    (def z0 '(1 2 3))
    (def z1 (forge/rotr z0 3))
    (assert (eq (forge/count z1) 3) "Rotate by size should preserve all elements")
    (def z1_list (cast :list-p z1))
    (assert (eq (at 0 z1_list) 1) "Should be back at start")
    (assert (eq (at 1 z1_list) 2) "Should be back at start")
    (assert (eq (at 2 z1_list) 3) "Should be back at start")
    (io/put "Rotate right by list length - no change\n")
    (def z2 (forge/rotl z0 6))
    (assert (eq (forge/count z2) 3) "Rotate by 2x size should preserve all elements")
    (def z2_list (cast :list-p z2))
    (assert (eq (at 0 z2_list) 1) "Should be back at start")
    (assert (eq (at 1 z2_list) 2) "Should be back at start")
    (assert (eq (at 2 z2_list) 3) "Should be back at start")
    (io/put "Rotate left by 2x list length - no change\n")

    (io/put "\n--- Rotate by 0 ---\n")
    (def w0 '(1 2 3))
    (def w1 (forge/rotr w0 0))
    (assert (eq (forge/count w1) 3) "Rotate by 0 should not change")
    (def w1_list (cast :list-p w1))
    (assert (eq (at 0 w1_list) 1) "First should stay 1")
    (assert (eq (at 1 w1_list) 2) "Second should stay 2")
    (assert (eq (at 2 w1_list) 3) "Third should stay 3")
    (io/put "Rotate by 0 - no change\n")

    (io/put "\n=== All rotation tests complete ===\n")
]
