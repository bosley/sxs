[
    #(load "fs" "io")

    (io/put "=== FS LS Edge Cases Test ===\n\n")

    (def tmp_dir (fs/tmp))
    (def test_dir (fs/join_path tmp_dir "test_ls_edge"))

    (io/put "--- Test ls on empty directory ---\n")
    (def exists_before (fs/exists test_dir))
    (if (eq exists_before 1)
        [
            (def rmdir_before (fs/rmdir_recursive test_dir))
        ]
        []
    )
    (def mkdir_result (fs/mkdir test_dir))
    (assert (eq mkdir_result 0) "mkdir should succeed")

    (def ls_result1 (fs/ls test_dir))
    (def ls_list1 (cast :list-b ls_result1))
    (assert (eq ls_list1 '[]) "Empty dir should return empty list")
    (io/put "Empty directory: OK\n")

    (io/put "\n--- Test ls with subdirectories ---\n")
    (def subdir1 (fs/join_path test_dir "subdir1"))
    (def subdir2 (fs/join_path test_dir "subdir2"))
    (def mkdir_sub1 (fs/mkdir subdir1))
    (assert (eq mkdir_sub1 0) "mkdir should succeed")
    (def mkdir_sub2 (fs/mkdir subdir2))
    (assert (eq mkdir_sub2 0) "mkdir should succeed")

    (def ls_result2 (fs/ls test_dir))
    (def ls_list2 (cast :list-b ls_result2))
    (def entry1 (at 0 ls_list2))
    (def entry2 (at 1 ls_list2))
    (assert (eq (eq entry1 "") 0) "First entry should exist")
    (assert (eq (eq entry2 "") 0) "Second entry should exist")
    (io/put "Directory with subdirs: OK\n")

    (io/put "\n--- Test ls with mixed files and subdirectories ---\n")
    (def file1 (fs/join_path test_dir "file1.txt"))
    (def file2 (fs/join_path test_dir "file2.txt"))
    (def subdir3 (fs/join_path test_dir "subdir3"))

    (def fid1 (fs/open "w" file1))
    (assert (eq (eq fid1 -1) 0) "File should open")
    (def close1 (fs/close fid1))
    (assert (eq close1 0) "Close should succeed")

    (def fid2 (fs/open "w" file2))
    (assert (eq (eq fid2 -1) 0) "File should open")
    (def close2 (fs/close fid2))
    (assert (eq close2 0) "Close should succeed")

    (def mkdir_sub3 (fs/mkdir subdir3))
    (assert (eq mkdir_sub3 0) "mkdir should succeed")

    (def ls_result3 (fs/ls test_dir))
    (def ls_list3 (cast :list-b ls_result3))
    (def entry3_1 (at 0 ls_list3))
    (def entry3_2 (at 1 ls_list3))
    (def entry3_3 (at 2 ls_list3))
    (def entry3_4 (at 3 ls_list3))
    (def entry3_5 (at 4 ls_list3))
    (assert (eq (eq entry3_1 "") 0) "Entry 1 should exist")
    (assert (eq (eq entry3_2 "") 0) "Entry 2 should exist")
    (assert (eq (eq entry3_3 "") 0) "Entry 3 should exist")
    (assert (eq (eq entry3_4 "") 0) "Entry 4 should exist")
    (assert (eq (eq entry3_5 "") 0) "Entry 5 should exist")
    (io/put "Mixed files and subdirs: OK\n")

    (io/put "\n--- Cleanup ---\n")
    (def rmdir_result (fs/rmdir_recursive test_dir))
    (assert (eq (eq rmdir_result -1) 0) "rmdir_recursive should succeed")
    (io/put "Removed test directory\n")

    (io/put "\n=== All ls edge case tests complete ===\n")
]

