[
    #(load "fs" "io")

    (io/put "=== FS Read Behavior Test ===\n\n")

    (def tmp_dir (fs/tmp))
    (def test_file (fs/join_path tmp_dir "test_read_behavior.txt"))

    (io/put "--- Create test file ---\n")
    (def fid1 (fs/open "w" test_file))
    (assert (eq (eq fid1 -1) 0) "File should open")
    (def write1 (fs/write fid1 "0123456789ABCDEF"))
    (assert (eq (eq write1 -1) 0) "Write should succeed")
    (def close1 (fs/close fid1))
    (assert (eq close1 0) "Close should succeed")
    (io/put "Created file with 16 bytes\n")

    (io/put "\n--- Test fs_read resets to beginning ---\n")
    (def fid2 (fs/open "r" test_file))
    (assert (eq (eq fid2 -1) 0) "File should open")
    (def seek1 (fs/seek fid2 8 0))
    (assert (eq (eq seek1 -1) 0) "Seek to position 8 should succeed")
    (def tell1 (fs/tell fid2))
    (assert (eq tell1 8) "Position should be 8")
    (def read1 (fs/read fid2))
    (assert (eq (eq read1 "") 0) "Read should succeed")
    (def tell2 (fs/tell fid2))
    (io/put "Position after read: %d (read resets to beginning)\n" tell2)

    (io/put "\n--- Test read_bytes maintains position ---\n")
    (def seek2 (fs/seek fid2 0 0))
    (assert (eq (eq seek2 -1) 0) "Seek to beginning should succeed")
    (def read2 (fs/read_bytes fid2 4))
    (assert (eq read2 "0123") "Should read first 4 bytes")
    (def tell3 (fs/tell fid2))
    (assert (eq tell3 4) "Position should be 4 after read_bytes")
    (io/put "Position after read_bytes(4): %d\n" tell3)

    (def read3 (fs/read_bytes fid2 4))
    (assert (eq read3 "4567") "Should read next 4 bytes")
    (def tell4 (fs/tell fid2))
    (assert (eq tell4 8) "Position should be 8")
    (io/put "Position after read_bytes(4) again: %d\n" tell4)

    (io/put "\n--- Test read_bytes after seek ---\n")
    (def seek3 (fs/seek fid2 10 0))
    (assert (eq (eq seek3 -1) 0) "Seek to position 10 should succeed")
    (def read4 (fs/read_bytes fid2 3))
    (assert (eq read4 "ABC") "Should read from position 10")
    (def tell5 (fs/tell fid2))
    (assert (eq tell5 13) "Position should be 13")
    (io/put "Read from position 10: OK\n")

    (io/put "\n--- Test reading entire file after partial reads ---\n")
    (def seek4 (fs/seek fid2 0 0))
    (assert (eq (eq seek4 -1) 0) "Seek to beginning should succeed")
    (def read5 (fs/read fid2))
    (assert (eq (eq read5 "") 0) "Read entire file should succeed")
    (io/put "Read entire file after partial reads: OK\n")

    (def close2 (fs/close fid2))
    (assert (eq close2 0) "Close should succeed")

    (io/put "\n--- Cleanup ---\n")
    (def remove_result (fs/remove test_file))
    (assert (eq remove_result 0) "Remove should succeed")
    (io/put "Removed test file\n")

    (io/put "\n=== All read behavior tests complete ===\n")
]

