[
    #(load "fs" "io")

    (io/put "=== FS File Metadata Test ===\n\n")

    (def tmp_dir (fs/tmp))
    (def test_file (fs/join_path tmp_dir "test_metadata.txt"))
    (def test_file2 (fs/join_path tmp_dir "test_rename.txt"))

    (io/put "--- Test exists (non-existent) ---\n")
    (def exists1 (fs/exists test_file))
    (assert (eq exists1 0) "File should not exist yet")
    (io/put "File exists check (before): %d\n" exists1)

    (io/put "\n--- Create file and test size ---\n")
    (def fid (fs/open "w" test_file))
    (assert (eq (eq fid -1) 0) "File should open")
    (def write_result (fs/write fid "Test content for metadata\nSecond line\n"))
    (assert (eq (eq write_result -1) 0) "Write should succeed")
    (io/put "Wrote %d bytes\n" write_result)

    (def size1 (fs/size fid))
    (assert (eq (eq size1 -1) 0) "Size should be valid")
    (io/put "File size: %d bytes\n" size1)

    (def close_result (fs/close fid))
    (assert (eq close_result 0) "Close should succeed")

    (io/put "\n--- Test exists (existing file) ---\n")
    (def exists2 (fs/exists test_file))
    (assert (eq exists2 1) "File should exist now")
    (io/put "File exists check (after): %d\n" exists2)

    (io/put "\n--- Test size on closed file ---\n")
    (def fid2 (fs/open "r" test_file))
    (assert (eq (eq fid2 -1) 0) "File should open")
    (def size2 (fs/size fid2))
    (assert (eq size2 size1) "Size should match")
    (io/put "File size (reopened): %d bytes\n" size2)
    (def close_result2 (fs/close fid2))
    (assert (eq close_result2 0) "Close should succeed")

    (io/put "\n--- Test rename ---\n")
    (def rename_result (fs/rename test_file test_file2))
    (assert (eq rename_result 0) "Rename should succeed")
    (io/put "Renamed file\n")

    (def exists3 (fs/exists test_file))
    (assert (eq exists3 0) "Old file should not exist")
    (io/put "Old file exists: %d\n" exists3)

    (def exists4 (fs/exists test_file2))
    (assert (eq exists4 1) "New file should exist")
    (io/put "New file exists: %d\n" exists4)

    (io/put "\n--- Test remove ---\n")
    (def remove_result (fs/remove test_file2))
    (assert (eq remove_result 0) "Remove should succeed")
    (io/put "Removed file\n")

    (def exists5 (fs/exists test_file2))
    (assert (eq exists5 0) "File should not exist after remove")
    (io/put "File exists after remove: %d\n" exists5)

    (io/put "\n=== All file metadata tests complete ===\n")
]

