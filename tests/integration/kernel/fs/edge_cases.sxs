[
    #(load "fs" "io")

    (io/put "=== FS Edge Cases Test ===\n\n")

    (def tmp_dir (fs/tmp))
    (def nonexistent_file (fs/join_path tmp_dir "nonexistent.txt"))
    (def nonexistent_dir (fs/join_path tmp_dir "nonexistent_dir"))

    (io/put "--- Test operations on non-existent file ---\n")
    (def exists1 (fs/exists nonexistent_file))
    (assert (eq exists1 0) "Non-existent file should not exist")
    (io/put "Non-existent file exists: %d\n" exists1)

    (def fid1 (fs/open "r" nonexistent_file))
    (assert (eq fid1 -1) "Opening non-existent file should fail")
    (io/put "Open non-existent file: %d\n" fid1)

    (io/put "\n--- Test operations on invalid file descriptor ---\n")
    (def read_invalid (fs/read -1))
    (assert (eq read_invalid "") "Read from invalid fd should return empty")
    (io/put "Read from invalid fd: empty\n")

    (def write_invalid (fs/write -1 "test"))
    (assert (eq write_invalid -1) "Write to invalid fd should fail")
    (io/put "Write to invalid fd: %d\n" write_invalid)

    (def close_invalid (fs/close -1))
    (assert (eq close_invalid -1) "Close invalid fd should fail")
    (io/put "Close invalid fd: %d\n" close_invalid)

    (io/put "\n--- Test rmdir on non-existent directory ---\n")
    (def rmdir_result (fs/rmdir nonexistent_dir))
    (assert (eq rmdir_result -1) "rmdir on non-existent dir should fail")
    (io/put "rmdir non-existent dir: %d\n" rmdir_result)

    (io/put "\n--- Test rmdir on file (not directory) ---\n")
    (def test_file (fs/join_path tmp_dir "test_file.txt"))
    (def fid2 (fs/open "w" test_file))
    (assert (eq (eq fid2 -1) 0) "File should open")
    (def write_result (fs/write fid2 "test"))
    (assert (eq (eq write_result -1) 0) "Write should succeed")
    (def close_result (fs/close fid2))
    (assert (eq close_result 0) "Close should succeed")

    (def rmdir_file_result (fs/rmdir test_file))
    (assert (eq rmdir_file_result -1) "rmdir on file should fail")
    (io/put "rmdir on file: %d\n" rmdir_file_result)

    (def remove_result (fs/remove test_file))
    (assert (eq remove_result 0) "Remove should succeed")
    (io/put "Removed test file\n")

    (io/put "\n--- Test ls on non-existent directory ---\n")
    (def ls_result (fs/ls nonexistent_dir))
    (io/put "ls non-existent dir: empty\n")

    (io/put "\n--- Test ls on file (not directory) ---\n")
    (def test_file2 (fs/join_path tmp_dir "test_file2.txt"))
    (def fid3 (fs/open "w" test_file2))
    (assert (eq (eq fid3 -1) 0) "File should open")
    (def write_result2 (fs/write fid3 "test"))
    (assert (eq (eq write_result2 -1) 0) "Write should succeed")
    (def close_result2 (fs/close fid3))
    (assert (eq close_result2 0) "Close should succeed")

    (def ls_file_result (fs/ls test_file2))
    (io/put "ls on file: empty\n")

    (def remove_result2 (fs/remove test_file2))
    (assert (eq remove_result2 0) "Remove should succeed")

    (io/put "\n--- Test size on empty file ---\n")
    (def empty_file (fs/join_path tmp_dir "empty.txt"))
    (def fid4 (fs/open "w" empty_file))
    (assert (eq (eq fid4 -1) 0) "File should open")
    (def close_result3 (fs/close fid4))
    (assert (eq close_result3 0) "Close should succeed")

    (def fid5 (fs/open "r" empty_file))
    (assert (eq (eq fid5 -1) 0) "File should open")
    (def size_empty (fs/size fid5))
    (assert (eq size_empty 0) "Empty file size should be 0")
    (io/put "Empty file size: %d\n" size_empty)

    (def close_result4 (fs/close fid5))
    (assert (eq close_result4 0) "Close should succeed")

    (def remove_result3 (fs/remove empty_file))
    (assert (eq remove_result3 0) "Remove should succeed")

    (io/put "\n=== All edge case tests complete ===\n")
]

